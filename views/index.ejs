<div class="row">
    <div class="span4 offset4 centerText">
        <h1>Expenses</h1>
    </div>
</div>

<div class="row bottomMargin">
    <div class="span4 offset4">
        <script type="text/x-handlebars">
            <div class="btn-group centered">
                <a class="btn dropdown-toggle" data-toggle="dropdown" href="#">
                    {{App.timeSpanController.selectedOrDefault.fromStringLong}} - {{App.timeSpanController.selectedOrDefault.toStringLong}}
                    <span class="caret"></span>
                </a>
                <table class="table dropdown-menu">
                    <thead>
                        <tr>
                            <td>From</td>
                            <td>To</td>
                            <td></td>
                        </tr>
                    </thead>
                    <tbody>
                        {{#each App.timeSpanController.timeSpans }}
                            {{#view App.timeSpanView contentBinding="this" tagName="tr" }}
                                <td>{{content.fromStringLong}}</td>
                                <td>{{content.toStringLong}}</td>
                                <td><button {{action "select" on="click"}} class="btn btn-primary">Select</button></td>
                            {{/view}}
                        {{/each}}
                    </tbody>
                </table>
            </div>
        </script>
    </div>
</div>

<div class="row">

    <div class="span4 centerText">
        <div id="expenseGraphContainer">
        </div>
    </div>

    <script type="text/x-handlebars">
        <div class="span4">
            {{#view App.summaryTableView class="table table-bordered" tagName="table"}}
                <thead>
                    <tr>
                        <td></td>
                        <td>Paid</td>
                        <td>Payout</td>
                    </tr>
                </thead>

                <tbody>
                    {{#each people}}
                        <tr>
                            <td>{{fullName}}</td>
                            <td>${{paidForPayoutString}}</td>
                            <td>
                                {{#if inDebtForPayout}}
                                    <span class="label label-important">${{absOweForPayoutString}}</span>
                                {{else}}
                                    <span class="label label-success">${{absOweForPayoutString}}</span>
                                {{/if}}
                            </td>
                        </tr>
                    {{/each}}
                </tbody>
            {{/view}}

            {{#if App.timeSpanController.selectedOrDefault.isCurrentTimeSpan}}
                <div id="expenseFormWrapper" class="bottomMargin">
                    <div class="centerText bottomDivider">
                        <h3>New Expense</h3>
                    </div>

                        {{#view App.expenseFormView class="form-vertical" tagName="form"}}
                            <label class="control-label" for="formAmount">Amount:</label>

                            <div class="input-prepend">
                                <span class="add-on">$</span>{{view App.expenseFormControls.amountView class="input-mini" }}
                            </div>

                            <label class="control-label" for="formComment">Comment:</label>
                            {{view App.expenseFormControls.commentView id="formComment" }}

                            <div class="centerText">
                                {{view App.expenseFormControls.submitView tagName="input" class="btn btn-primary" }}
                                {{view App.expenseFormControls.cancelView tagName="input" class="btn" }}
                            </div>
                        {{/view}}

                        {{#view App.formAlertView class="alert alert-error"}}
                            Unable to submit expense:
                            <ul>
                                {{#each errors}}
                                <li>{{ this }}</li>
                                {{/each}}
                            </ul>
                        {{/view}}
                </div>

                <div class="centerText">
                    {{#view App.payoutView tagName="button" class="btn btn-large btn-danger"}}Payout{{/view}}
                </div>
            {{else}}
                <div class="alert alert-warning centerText">
                    <span>Expenses can only be added to the current payout</span>
                    <br/>
                    {{#view App.showCurrentTimeSpanView tagName="a" }}
                        To add more expenses, click here
                    {{/view}}
                </div>
            {{/if}}
        </div>
    </script>

    <div class="span4 centerText">
        <script type="text/x-handlebars">
            {{#view App.expenseTableView class="table table-striped" tagName="table"}}
                <thead>
                    <tr>
                        <td>Date</td>
                        <td>Payer</td>
                        <td>Amount</td>
                        <td></td>
                    </tr>
                </thead>

                <tbody>
                    {{#each content}}
                        {{#view App.expenseTableItem contentBinding="this" tagName="tr"}}
                            <td>{{content.timeStampString}}</td>
                            <td>{{content.payerString}}</td>
                            <td>{{content.amountString}}</td>
                            <td>
                                {{#if canRemove }}
                                    <i {{action "remove" on="click"}} class="icon-trash"></i>
                                {{/if}}
                            </td>
                        {{/view}}
                    {{/each}}
                </tbody>
            {{/view}}
        </script>

        <ul class="pager">
            <script type="text/x-handlebars">
                {{#view App.pagerViews.newer tagName="li" class="previous"}}
                    <a href="#">&larr; Newer</a>
                {{/view}}

                {{#view App.pagerViews.older tagName="li" class="next"}}
                    <a href="#">Older &rarr;</a>
                {{/view}}
            </script>
        </ul>
    </div>
</div>
